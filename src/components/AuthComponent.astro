---
// This component handles Firebase authentication on the client side
---

<div id="auth-container"></div>

<script is:inline>
  // This script will be inlined in the HTML
  (async function() {
    try {
      // Dynamically import Firebase modules from CDN
      const { initializeApp } = await import('https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js');
      const { 
        getAuth, 
        onAuthStateChanged 
      } = await import('https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js');

      // Check if env vars exist
      const config = {
        apiKey: import.meta.env.VITE_FIREBASE_API_KEY,
        authDomain: import.meta.env.VITE_FIREBASE_AUTH_DOMAIN,
        projectId: import.meta.env.VITE_FIREBASE_PROJECT_ID,
        storageBucket: import.meta.env.VITE_FIREBASE_STORAGE_BUCKET,
        messagingSenderId: import.meta.env.VITE_FIREBASE_MESSAGING_SENDER_ID,
        appId: import.meta.env.VITE_FIREBASE_APP_ID
      };

      console.log('ğŸ” Firebase config:', {
        apiKey: config.apiKey ? 'âœ… Set' : 'âŒ Missing',
        authDomain: config.authDomain ? 'âœ… Set' : 'âŒ Missing',
        projectId: config.projectId ? 'âœ… Set' : 'âŒ Missing',
        storageBucket: config.storageBucket ? 'âœ… Set' : 'âŒ Missing',
        messagingSenderId: config.messagingSenderId ? 'âœ… Set' : 'âŒ Missing',
        appId: config.appId ? 'âœ… Set' : 'âŒ Missing'
      });

      if (!config.apiKey || !config.authDomain || !config.projectId) {
        throw new Error('Firebase credentials are incomplete!');
      }

      console.log('ğŸš€ Initializing Firebase...');
      
      // Initialize Firebase
      const app = initializeApp(config);
      const auth = getAuth(app);

      // Set up auth state observer
      const unsubscribe = onAuthStateChanged(auth, (user) => {
        console.log('ğŸ”‘ Auth state changed:', user ? 'User signed in' : 'No user');
        document.dispatchEvent(new CustomEvent('auth-state-changed', { 
          detail: { user } 
        }));
      });

      console.log('âœ… Firebase initialized successfully');
      
      // Cleanup on page unload
      window.addEventListener('beforeunload', () => {
        console.log('ğŸ§¹ Cleaning up Firebase auth listener');
        unsubscribe();
      });
    } catch (error) {
      console.error('âŒ Error initializing Firebase:', error);
      document.dispatchEvent(new CustomEvent('auth-error', { 
        detail: { error: error.message } 
      }));
    }
  })();
</script>
